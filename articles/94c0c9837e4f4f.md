---
title: "prometheus ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
emoji: "ğŸƒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["prometheus"]
published: false
---

EC2 ã« prometheus ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

## ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ

```bash
sudo mkdir /opt/prometheus
cd /opt/prometheus
```

## ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

https://prometheus.io/download/

```bash
sudo wget https://github.com/prometheus/prometheus/releases/download/v2.37.6/prometheus-2.37.6.linux-amd64.tar.gz
```

## å±•é–‹

```bash
sudo tar xvfz prometheus-2.37.6.linux-amd64.tar.gz
cd prometheus-2.37.6.linux-amd64
```

## ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ

```bash
sudo usergroup add prometheus
```

## ãƒ¦ãƒ¼ã‚¶ä½œæˆ

```bash
sudo useradd -s /usr/nologin -g prometheus prometheus
```

## å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«é…ç½®

```bash
sudo cp -p ./prometheus /usr/local/bin/prometheus
```

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«é…ç½®

```bash
sudo mkdir /etc/prometheus
sudo cp -p prometheus.yml /etc/prometheus/promethues.yml
```

## ãƒ­ã‚°ã®ä¿å­˜å…ˆä½œæˆ

```bash
sudo mkdir -p /var/lib/prometheus/data
sudo chown -R prometheus:prometheus /var/lib/prometheus/data
```

## console templateã‚’è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸é…ç½®

```bash
sudo cp -rp consoles consoles /etc/prometheus/consoles
sudo cp -rp console_libraries /etc/prometheus/console_libraries
```

## ãƒ¦ãƒ‹ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

```bash
sudo vim /etc/systemd/system/prometheus.service
```

```bash
[Unit]
Description=Prometheus Server
Documentation=https://prometheus.io/docs/introduction/overview/
After=network-online.target

[Service]
User=prometheus
ExecStart=/usr/local/bin/prometheus \
	--config.file=/etc/prometheus/prometheus.yml \
	--storage.tsdb.path=/var/lib/prometheus/data \
	--web.console.templates=/etc/prometheus/consoles \
	--web.console.libraries=/etc/prometheus/console_libraries
ExecStop=/bin/kill -TERM ${MAINPID}
ExecReload=/bin/kill -HUP ${MAINPID}

[Install]
WantedBy=multi-user.target
```

## èµ·å‹•

```bash
sudo systemctl daemon-reload
sudo systemctl start prometheus.service
sudo systemctl status prometheus.service
# è‡ªå‹•èµ·å‹•ã‚’æœ‰åŠ¹ã«ã™ã‚‹
sudo systemctl enable prometheus.service
```

ãƒ­ã‚°ã®ç¢ºèª

```bash
sudo journalctl -exu prometheus
```
